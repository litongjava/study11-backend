<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸‰è§’å‡½æ•°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4eaf5 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .main-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            padding: 20px;
        }
        .animation-container {
            flex: 1;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 40px;
            position: relative;
            overflow: hidden;
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .subtitle-container {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            margin: 5px 0;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .subtitle {
            color: black;
            border-radius: 30px;
            font-size: 1.4rem;
            max-width: 80%;
            text-align: center;
            line-height: 1.5;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .subtitle.active {
            opacity: 1;
        }
        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 5px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
        }
        .control-btn {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 50%;
            background: #3498db;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 1.2rem;
        }
        .control-btn:hover {
            background: #2980b9;
            transform: scale(1.1);
        }
        .control-btn:active {
            transform: scale(0.95);
        }
        .control-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }
        .progress-container {
            flex: 1;
            max-width: 400px;
            margin: 0 20px;
            display: flex;
            align-items: center;
        }
        .progress-bar {
            flex: 1;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            cursor: pointer;
            position: relative;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            border-radius: 4px;
            width: 0%;
            transition: width 0.1s ease;
        }
        .progress-handle {
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            background: white;
            border: 3px solid #3498db;
            border-radius: 50%;
            cursor: grab;
            left: 0%;
        }
        .progress-handle:active {
            cursor: grabbing;
        }
        .time-display {
            min-width: 100px;
            text-align: center;
            font-size: 0.9rem;
            color: #2c3e50;
            font-weight: 500;
        }
        .footer {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }
        .loading.active {
            display: flex;
        }
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(52, 152, 219, 0.2);
            border-radius: 50%;
            border-top-color: #3498db;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 15px;
        }
        .loading-text {
            font-size: 1.2rem;
            color: #3498db;
        }
        .cache-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(46, 204, 113, 0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            display: none;
        }
        .cache-indicator.active {
            display: block;
        }
        .scene-number {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(52, 152, 219, 0.8);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .trig-scene {
            width: 100%;
            height: 100%;
            position: relative;
        }
        .scene-title {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.8rem;
            color: #2c3e50;
            font-weight: 300;
            text-align: center;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        .scene-title.active {
            opacity: 1;
        }
        @media (max-width: 768px) {
            .animation-container {
                padding: 20px;
                min-height: 300px;
            }

            .subtitle {
                font-size: 1rem;
                padding: 12px 20px;
            }

            .control-btn {
                width: 45px;
                height: 45px;
            }

            .scene-title {
                font-size: 1.4rem;
            }

            .scene-number {
                width: 35px;
                height: 35px;
                font-size: 1.2rem;
            }

            .time-display {
                min-width: 80px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
<div class="main-container">
    <div class="animation-container">
        <div class="loading" id="loading">
            <div class="loading-spinner"></div>
            <div class="loading-text">åŠ è½½ä¸­...</div>
        </div>
        <div class="cache-indicator" id="cacheIndicator">ä½¿ç”¨ç¼“å­˜çš„éŸ³é¢‘</div>
        <div class="scene-number" id="sceneNumber">1</div>

        <svg class="trig-scene" viewBox="0 0 800 400">
            <!-- èƒŒæ™¯ç½‘æ ¼ -->
            <defs>
                <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
                    <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#e0e0e0" stroke-width="1"/>
                </pattern>

                <!-- æ¸å˜å®šä¹‰ -->
                <linearGradient id="angleGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#3498db;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#2980b9;stop-opacity:1" />
                </linearGradient>

                <linearGradient id="sinGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#e74c3c;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#c0392b;stop-opacity:1" />
                </linearGradient>

                <linearGradient id="cosGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" style="stop-color:#2ecc71;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#27ae60;stop-opacity:1" />
                </linearGradient>

                <linearGradient id="tanGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" style="stop-color:#f39c12;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#d35400;stop-opacity:1" />
                </linearGradient>
            </defs>

            <rect width="800" height="400" fill="url(#grid)" />

            <!-- åœºæ™¯æ ‡é¢˜ -->
            <text x="800" y="30" text-anchor="middle" fill="#2c3e50" font-size="24" font-weight="300" class="scene-title" id="sceneTitle">
                ä¸‰è§’å‡½æ•°ç®€ä»‹
            </text>

            <!-- è§†è§‰é¢æ¿ -->
            <g id="visualPanel">
                <!-- åœºæ™¯1: ä¸‰è§’å‡½æ•°ç®€ä»‹ -->
                <g id="scene1">
                    <!-- ç›´è§’ä¸‰è§’å½¢ -->
                    <path d="M 400 200 L 500 200 L 500 100 Z" fill="rgba(52, 152, 219, 0.2)" stroke="#3498db" stroke-width="2"/>

                    <!-- è§’æ ‡è®° -->
                    <path d="M 420 200 A 20 20 0 0 0 414.14 185.86" fill="none" stroke="#e74c3c" stroke-width="2"/>
                    <text x="410" y="190" fill="#e74c3c" font-size="16">Î¸</text>

                    <!-- è¾¹æ ‡è®° -->
                    <text x="445" y="220" fill="#2c3e50" font-size="16">é‚»è¾¹</text>
                    <text x="510" y="150" fill="#2c3e50" font-size="16">å¯¹è¾¹</text>
                    <text x="440" y="140" fill="#2c3e50" font-size="16">æ–œè¾¹</text>

                    <!-- å‡½æ•°å®šä¹‰ -->
                    <text x="300" y="280" fill="#2c3e50" font-size="18">sin Î¸ = å¯¹è¾¹ / æ–œè¾¹</text>
                    <text x="300" y="310" fill="#2c3e50" font-size="18">cos Î¸ = é‚»è¾¹ / æ–œè¾¹</text>
                    <text x="300" y="340" fill="#2c3e50" font-size="18">tan Î¸ = å¯¹è¾¹ / é‚»è¾¹</text>
                </g>

                <!-- åœºæ™¯2: å•ä½åœ† -->
                <g id="scene2" style="display: none;">
                    <!-- åæ ‡è½´ -->
                    <line x1="300" y1="200" x2="700" y2="200" stroke="#34495e" stroke-width="2"/>
                    <line x1="500" y1="50" x2="500" y2="350" stroke="#34495e" stroke-width="2"/>

                    <!-- åæ ‡è½´æ ‡è®° -->
                    <text x="710" y="205" fill="#34495e" font-size="16">x</text>
                    <text x="505" y="45" fill="#34495e" font-size="16">y</text>

                    <!-- å•ä½åœ† -->
                    <circle cx="500" cy="200" r="100" fill="none" stroke="#3498db" stroke-width="2"/>

                    <!-- æ—‹è½¬çš„åŠå¾„ -->
                    <line id="radius" x1="500" y1="200" x2="600" y2="200" stroke="#3498db" stroke-width="3">
                        <animateTransform attributeName="transform" type="rotate" from="0 500 200" to="360 500 200" dur="10s" repeatCount="indefinite"/>
                    </line>

                    <!-- ç‚¹ -->
                    <circle id="point" cx="600" cy="200" r="6" fill="#e74c3c">
                        <animateTransform attributeName="transform" type="rotate" from="0 500 200" to="360 500 200" dur="10s" repeatCount="indefinite"/>
                    </circle>

                    <!-- æ­£å¼¦çº¿ -->
                    <line id="sinLine" x1="600" y1="200" x2="600" y2="200" stroke="url(#sinGradient)" stroke-width="2">
                        <animateTransform attributeName="transform" type="rotate" from="0 500 200" to="360 500 200" dur="10s" repeatCount="indefinite"/>
                    </line>

                    <!-- ä½™å¼¦çº¿ -->
                    <line id="cosLine" x1="500" y1="200" x2="600" y2="200" stroke="url(#cosGradient)" stroke-width="2">
                        <animateTransform attributeName="transform" type="rotate" from="0 500 200" to="360 500 200" dur="10s" repeatCount="indefinite"/>
                    </line>

                    <!-- æ ‡ç­¾ -->
                    <text x="300" y="280" fill="#2c3e50" font-size="18">å•ä½åœ†: xÂ² + yÂ² = 1</text>
                    <text x="300" y="310" fill="#2c3e50" font-size="18">cos Î¸ = x, sin Î¸ = y</text>
                </g>

                <!-- åœºæ™¯3: æ­£å¼¦å‡½æ•°å›¾åƒ -->
                <g id="scene3" style="display: none;">
                    <!-- åæ ‡è½´ -->
                    <line x1="100" y1="200" x2="700" y2="200" stroke="#34495e" stroke-width="2"/>
                    <line x1="400" y1="50" x2="400" y2="350" stroke="#34495e" stroke-width="2"/>

                    <!-- åæ ‡è½´æ ‡è®° -->
                    <text x="710" y="205" fill="#34495e" font-size="16">x</text>
                    <text x="405" y="45" fill="#34495e" font-size="16">y</text>

                    <!-- åˆ»åº¦ -->
                    <line x1="300" y1="195" x2="300" y2="205" stroke="#34495e" stroke-width="2"/>
                    <text x="295" y="220" fill="#34495e" font-size="14">-Ï€/2</text>

                    <line x1="500" y1="195" x2="500" y2="205" stroke="#34495e" stroke-width="2"/>
                    <text x="495" y="220" fill="#34495e" font-size="14">Ï€/2</text>

                    <line x1="600" y1="195" x2="600" y2="205" stroke="#34495e" stroke-width="2"/>
                    <text x="595" y="220" fill="#34495e" font-size="14">Ï€</text>

                    <line x1="200" y1="195" x2="200" y2="205" stroke="#34495e" stroke-width="2"/>
                    <text x="195" y="220" fill="#34495e" font-size="14">-Ï€</text>

                    <!-- æ­£å¼¦æ›²çº¿ -->
                    <path d="M 100 200
                                 C 150 200, 200 100, 300 100
                                 S 500 300, 600 300
                                 S 700 200, 700 200"
                          fill="none" stroke="url(#sinGradient)" stroke-width="3"/>

                    <!-- æ ‡ç­¾ -->
                    <text x="300" y="280" fill="#2c3e50" font-size="18">y = sin(x)</text>
                    <text x="300" y="310" fill="#2c3e50" font-size="18">å‘¨æœŸ: 2Ï€, æŒ¯å¹…: 1</text>
                </g>

                <!-- åœºæ™¯4: ä½™å¼¦å‡½æ•°å›¾åƒ -->
                <g id="scene4" style="display: none;">
                    <!-- åæ ‡è½´ -->
                    <line x1="100" y1="200" x2="700" y2="200" stroke="#34495e" stroke-width="2"/>
                    <line x1="400" y1="50" x2="400" y2="350" stroke="#34495e" stroke-width="2"/>

                    <!-- åæ ‡è½´æ ‡è®° -->
                    <text x="710" y="205" fill="#34495e" font-size="16">x</text>
                    <text x="405" y="45" fill="#34495e" font-size="16">y</text>

                    <!-- åˆ»åº¦ -->
                    <line x1="300" y1="195" x2="300" y2="205" stroke="#34495e" stroke-width="2"/>
                    <text x="295" y="220" fill="#34495e" font-size="14">-Ï€/2</text>

                    <line x1="500" y1="195" x2="500" y2="205" stroke="#34495e" stroke-width="2"/>
                    <text x="495" y="220" fill="#34495e" font-size="14">Ï€/2</text>

                    <line x1="600" y1="195" x2="600" y2="205" stroke="#34495e" stroke-width="2"/>
                    <text x="595" y="220" fill="#34495e" font-size="14">Ï€</text>

                    <line x1="200" y1="195" x2="200" y2="205" stroke="#34495e" stroke-width="2"/>
                    <text x="195" y="220" fill="#34495e" font-size="14">-Ï€</text>

                    <!-- ä½™å¼¦æ›²çº¿ -->
                    <path d="M 100 100
                                 C 150 100, 200 200, 300 200
                                 S 500 200, 600 200
                                 S 700 100, 700 100"
                          fill="none" stroke="url(#cosGradient)" stroke-width="3"/>

                    <!-- æ ‡ç­¾ -->
                    <text x="300" y="280" fill="#2c3e50" font-size="18">y = cos(x)</text>
                    <text x="300" y="310" fill="#2c3e50" font-size="18">å‘¨æœŸ: 2Ï€, æŒ¯å¹…: 1</text>
                </g>

                <!-- åœºæ™¯5: æ­£åˆ‡å‡½æ•°å›¾åƒ -->
                <g id="scene5" style="display: none;">
                    <!-- åæ ‡è½´ -->
                    <line x1="100" y1="200" x2="700" y2="200" stroke="#34495e" stroke-width="2"/>
                    <line x1="400" y1="50" x2="400" y2="350" stroke="#34495e" stroke-width="2"/>

                    <!-- åæ ‡è½´æ ‡è®° -->
                    <text x="710" y="205" fill="#34495e" font-size="16">x</text>
                    <text x="405" y="45" fill="#34495e" font-size="16">y</text>

                    <!-- åˆ»åº¦ -->
                    <line x1="300" y1="195" x2="300" y2="205" stroke="#34495e" stroke-width="2"/>
                    <text x="295" y="220" fill="#34495e" font-size="14">-Ï€/2</text>

                    <line x1="500" y1="195" x2="500" y2="205" stroke="#34495e" stroke-width="2"/>
                    <text x="495" y="220" fill="#34495e" font-size="14">Ï€/2</text>

                    <line x1="600" y1="195" x2="600" y2="205" stroke="#34495e" stroke-width="2"/>
                    <text x="595" y="220" fill="#34495e" font-size="14">Ï€</text>

                    <line x1="200" y1="195" x2="200" y2="205" stroke="#34495e" stroke-width="2"/>
                    <text x="195" y="220" fill="#34495e" font-size="14">-Ï€</text>

                    <!-- æ¸è¿‘çº¿ -->
                    <line x1="300" y1="50" x2="300" y2="350" stroke="#95a5a6" stroke-width="1" stroke-dasharray="5,5"/>
                    <line x1="500" y1="50" x2="500" y2="350" stroke="#95a5a6" stroke-width="1" stroke-dasharray="5,5"/>

                    <!-- æ­£åˆ‡æ›²çº¿ -->
                    <path d="M 100 150
                                 C 150 150, 250 50, 295 50
                                 M 305 350
                                 C 350 350, 450 50, 495 50
                                 M 505 350
                                 C 550 350, 650 50, 695 50"
                          fill="none" stroke="url(#tanGradient)" stroke-width="3"/>

                    <!-- æ ‡ç­¾ -->
                    <text x="300" y="280" fill="#2c3e50" font-size="18">y = tan(x)</text>
                    <text x="300" y="310" fill="#2c3e50" font-size="18">å‘¨æœŸ: Ï€, æ¸è¿‘çº¿: x = Ï€/2 + kÏ€</text>
                </g>

                <!-- åœºæ™¯6: ä¸‰è§’å‡½æ•°åº”ç”¨ -->
                <g id="scene6" style="display: none;">
                    <!-- å»ºç­‘ç‰© -->
                    <rect x="300" y="100" width="100" height="200" fill="#95a5a6"/>
                    <polygon points="300,100 350,50 400,100" fill="#e74c3c"/>

                    <!-- å¤ªé˜³ -->
                    <circle cx="550" cy="100" r="30" fill="#f39c12"/>

                    <!-- å…‰çº¿ -->
                    <line x1="520" y1="100" x2="350" y2="100" stroke="#f39c12" stroke-width="2"/>

                    <!-- å½±å­ -->
                    <rect x="400" y="300" width="80" height="5" fill="#34495e"/>

                    <!-- è§’åº¦æ ‡è®° -->
                    <path d="M 400 295 A 10 10 0 0 0 395 285" fill="none" stroke="#e74c3c" stroke-width="2"/>
                    <text x="385" y="285" fill="#e74c3c" font-size="16">Î¸</text>

                    <!-- æ ‡ç­¾ -->
                    <text x="300" y="350" fill="#2c3e50" font-size="18">tan Î¸ = å»ºç­‘é«˜åº¦ / å½±å­é•¿åº¦</text>
                    <text x="300" y="380" fill="#2c3e50" font-size="18">é«˜åº¦ = å½±å­é•¿åº¦ Ã— tan Î¸</text>
                </g>
            </g>
        </svg>
    </div>

    <div class="subtitle-container">
        <div class="subtitle" id="subtitle"></div>
    </div>

    <div class="controls">
        <button class="control-btn" id="playBtn" title="æ’­æ”¾" disabled>
            <span id="playIcon">â–¶</span>
        </button>
        <button class="control-btn" id="muteBtn" title="é™éŸ³">
            <span id="muteIcon">ğŸ”Š</span>
        </button>
        <div class="progress-container">
            <div class="progress-bar" id="progressBar">
                <div class="progress-fill" id="progressFill"></div>
                <div class="progress-handle" id="progressHandle"></div>
            </div>
            <div class="time-display" id="timeDisplay">00:00 / 00:00</div>
        </div>
    </div>
</div>

<div class="footer">
    Â© 2023 https://study11.ai/
</div>

<!-- ä¸ºæ¯ä¸ªåœºæ™¯åˆ›å»ºä¸€ä¸ªéŸ³é¢‘å…ƒç´  -->
<div id="audioContainer"></div>

<script>
    // åŠ¨ç”»åœºæ™¯æ•°æ®
    const scenes = [
        {
            title: "ä¸‰è§’å‡½æ•°ç®€ä»‹",
            subtitle: "ä¸‰è§’å‡½æ•°æ˜¯æ•°å­¦ä¸­é‡è¦çš„å‡½æ•°ï¼Œå®ƒä»¬æè¿°äº†ç›´è§’ä¸‰è§’å½¢ä¸­è§’åº¦ä¸è¾¹é•¿ä¹‹é—´çš„å…³ç³»ã€‚æœ€åŸºæœ¬çš„ä¸‰è§’å‡½æ•°æ˜¯æ­£å¼¦ã€ä½™å¼¦å’Œæ­£åˆ‡ã€‚",
            action: () => {
                // æ˜¾ç¤ºåœºæ™¯1ï¼Œéšè—å…¶ä»–åœºæ™¯
                for (let i = 1; i <= 6; i++) {
                    document.getElementById(`scene${i}`).style.display = i === 1 ? 'block' : 'none';
                }
                // æ›´æ–°æ ‡é¢˜
                document.getElementById('sceneTitle').textContent = "ä¸‰è§’å‡½æ•°ç®€ä»‹";
                document.getElementById('sceneTitle').classList.add('active');
                // æ›´æ–°åœºæ™¯ç¼–å·
                document.getElementById('sceneNumber').textContent = '1';
            }
        },
        {
            title: "å•ä½åœ†ä¸ä¸‰è§’å‡½æ•°",
            subtitle: "å•ä½åœ†æ˜¯åŠå¾„ä¸º1çš„åœ†ï¼Œå®ƒåœ¨ä¸‰è§’å‡½æ•°ä¸­æ‰®æ¼”ç€é‡è¦è§’è‰²ã€‚åœ¨å•ä½åœ†ä¸Šï¼Œä»»æ„è§’åº¦Î¸çš„ç»ˆè¾¹ä¸å•ä½åœ†çš„äº¤ç‚¹åæ ‡ä¸º(cos Î¸, sin Î¸)ã€‚",
            action: () => {
                // æ˜¾ç¤ºåœºæ™¯2ï¼Œéšè—å…¶ä»–åœºæ™¯
                for (let i = 1; i <= 6; i++) {
                    document.getElementById(`scene${i}`).style.display = i === 2 ? 'block' : 'none';
                }
                // æ›´æ–°æ ‡é¢˜
                document.getElementById('sceneTitle').textContent = "å•ä½åœ†ä¸ä¸‰è§’å‡½æ•°";
                document.getElementById('sceneTitle').classList.add('active');
                // æ›´æ–°åœºæ™¯ç¼–å·
                document.getElementById('sceneNumber').textContent = '2';
            }
        },
        {
            title: "æ­£å¼¦å‡½æ•°å›¾åƒ",
            subtitle: "æ­£å¼¦å‡½æ•°y=sin(x)æ˜¯ä¸€ä¸ªå‘¨æœŸä¸º2Ï€çš„å‡½æ•°ï¼Œå…¶å›¾åƒåœ¨[-1,1]ä¹‹é—´æ³¢åŠ¨ã€‚æ­£å¼¦å‡½æ•°åœ¨x=0æ—¶å€¼ä¸º0ï¼Œåœ¨x=Ï€/2æ—¶è¾¾åˆ°æœ€å¤§å€¼1ï¼Œåœ¨x=Ï€æ—¶å›åˆ°0ã€‚",
            action: () => {
                // æ˜¾ç¤ºåœºæ™¯3ï¼Œéšè—å…¶ä»–åœºæ™¯
                for (let i = 1; i <= 6; i++) {
                    document.getElementById(`scene${i}`).style.display = i === 3 ? 'block' : 'none';
                }
                // æ›´æ–°æ ‡é¢˜
                document.getElementById('sceneTitle').textContent = "æ­£å¼¦å‡½æ•°å›¾åƒ";
                document.getElementById('sceneTitle').classList.add('active');
                // æ›´æ–°åœºæ™¯ç¼–å·
                document.getElementById('sceneNumber').textContent = '3';
            }
        },
        {
            title: "ä½™å¼¦å‡½æ•°å›¾åƒ",
            subtitle: "ä½™å¼¦å‡½æ•°y=cos(x)ä¹Ÿæ˜¯ä¸€ä¸ªå‘¨æœŸä¸º2Ï€çš„å‡½æ•°ï¼Œå…¶å›¾åƒåœ¨[-1,1]ä¹‹é—´æ³¢åŠ¨ã€‚ä¸æ­£å¼¦å‡½æ•°ä¸åŒï¼Œä½™å¼¦å‡½æ•°åœ¨x=0æ—¶è¾¾åˆ°æœ€å¤§å€¼1ï¼Œåœ¨x=Ï€/2æ—¶å€¼ä¸º0ã€‚",
            action: () => {
                // æ˜¾ç¤ºåœºæ™¯4ï¼Œéšè—å…¶ä»–åœºæ™¯
                for (let i = 1; i <= 6; i++) {
                    document.getElementById(`scene${i}`).style.display = i === 4 ? 'block' : 'none';
                }
                // æ›´æ–°æ ‡é¢˜
                document.getElementById('sceneTitle').textContent = "ä½™å¼¦å‡½æ•°å›¾åƒ";
                document.getElementById('sceneTitle').classList.add('active');
                // æ›´æ–°åœºæ™¯ç¼–å·
                document.getElementById('sceneNumber').textContent = '4';
            }
        },
        {
            title: "æ­£åˆ‡å‡½æ•°å›¾åƒ",
            subtitle: "æ­£åˆ‡å‡½æ•°y=tan(x)æ˜¯æ­£å¼¦ä¸ä½™å¼¦çš„æ¯”å€¼ï¼Œå³tan(x)=sin(x)/cos(x)ã€‚å®ƒçš„å‘¨æœŸæ˜¯Ï€ï¼Œå¹¶ä¸”åœ¨cos(x)=0çš„ç‚¹ä¸Šæœ‰å‚ç›´æ¸è¿‘çº¿ï¼Œæ­¤æ—¶å‡½æ•°å€¼è¶‹å‘äºæ— ç©·å¤§ã€‚",
            action: () => {
                // æ˜¾ç¤ºåœºæ™¯5ï¼Œéšè—å…¶ä»–åœºæ™¯
                for (let i = 1; i <= 6; i++) {
                    document.getElementById(`scene${i}`).style.display = i === 5 ? 'block' : 'none';
                }
                // æ›´æ–°æ ‡é¢˜
                document.getElementById('sceneTitle').textContent = "æ­£åˆ‡å‡½æ•°å›¾åƒ";
                document.getElementById('sceneTitle').classList.add('active');
                // æ›´æ–°åœºæ™¯ç¼–å·
                document.getElementById('sceneNumber').textContent = '5';
            }
        },
        {
            title: "ä¸‰è§’å‡½æ•°çš„å®é™…åº”ç”¨",
            subtitle: "ä¸‰è§’å‡½æ•°åœ¨ç°å®ç”Ÿæ´»ä¸­æœ‰å¹¿æ³›çš„åº”ç”¨ï¼Œå¦‚æµ‹é‡å»ºç­‘ç‰©é«˜åº¦ã€è®¡ç®—å¤©ä½“è·ç¦»ã€åˆ†æå£°æ³¢å’Œå…‰æ³¢ç­‰ã€‚é€šè¿‡æµ‹é‡è§’åº¦å’Œå·²çŸ¥è¾¹é•¿ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‰è§’å‡½æ•°è®¡ç®—å‡ºæœªçŸ¥é‡ã€‚",
            action: () => {
                // æ˜¾ç¤ºåœºæ™¯6ï¼Œéšè—å…¶ä»–åœºæ™¯
                for (let i = 1; i <= 6; i++) {
                    document.getElementById(`scene${i}`).style.display = i === 6 ? 'block' : 'none';
                }
                // æ›´æ–°æ ‡é¢˜
                document.getElementById('sceneTitle').textContent = "ä¸‰è§’å‡½æ•°çš„å®é™…åº”ç”¨";
                document.getElementById('sceneTitle').classList.add('active');
                // æ›´æ–°åœºæ™¯ç¼–å·
                document.getElementById('sceneNumber').textContent = '6';
            }
        }
    ];

    // å…¨å±€å˜é‡
    let currentScene = 0;
    let isPlaying = false;
    let isMuted = false;
    let audioElements = [];
    let sceneStartTime = 0;
    let totalDuration = 0;
    let sceneTimestamps = []; // è®°å½•æ¯ä¸ªåœºæ™¯çš„å¼€å§‹æ—¶é—´æˆ³
    let isDragging = false;
    let audioCache = null; // Cache Storage å®ä¾‹
    let cacheExpiry = 7 * 24 * 60 * 60 * 1000; // ç¼“å­˜æœ‰æ•ˆæœŸï¼š7å¤©
    let pausedScene = 0;
    let pausedTime = 0;
    let wasPausedByUser = false;

    // DOMå…ƒç´ 
    const playBtn = document.getElementById('playBtn');
    const playIcon = document.getElementById('playIcon');
    const muteBtn = document.getElementById('muteBtn');
    const muteIcon = document.getElementById('muteIcon');
    const progressBar = document.getElementById('progressBar');
    const progressFill = document.getElementById('progressFill');
    const progressHandle = document.getElementById('progressHandle');
    const subtitle = document.getElementById('subtitle');
    const loading = document.getElementById('loading');
    const audioContainer = document.getElementById('audioContainer');
    const cacheIndicator = document.getElementById('cacheIndicator');
    const timeDisplay = document.getElementById('timeDisplay');
    const sceneTitle = document.getElementById('sceneTitle');
    const sceneNumber = document.getElementById('sceneNumber');

    // åˆå§‹åŒ– Cache Storage
    async function initCacheStorage() {
        try {
            audioCache = await caches.open('tts-audio-v1');
            console.log('Cache Storage åˆå§‹åŒ–æˆåŠŸ');
        } catch (error) {
            console.error('Cache Storage åˆå§‹åŒ–å¤±è´¥:', error);
            audioCache = null;
        }
    }

    // ç”Ÿæˆç¼“å­˜é”®å
    function getCacheKey(text) {
        // ä½¿ç”¨ç®€å•çš„å“ˆå¸Œå‡½æ•°ç”Ÿæˆä¸€è‡´çš„é”®å
        let hash = 0;
        for (let i = 0; i < text.length; i++) {
            const char = text.charCodeAt(i);
            hash = ((hash << 5) - hash) + char;
            hash = hash & hash; // è½¬æ¢ä¸º32ä½æ•´æ•°
        }
        return `tts-${Math.abs(hash)}`;
    }

    // æ£€æŸ¥ç¼“å­˜æ˜¯å¦è¿‡æœŸ
    function isCacheExpired(timestamp) {
        return Date.now() - timestamp > cacheExpiry;
    }

    // ä»Cache Storageè·å–éŸ³é¢‘
    async function getAudioFromCache(text) {
        if (!audioCache) return null;

        try {
            const cacheKey = getCacheKey(text);
            const response = await audioCache.match(cacheKey);

            if (response) {
                // æ£€æŸ¥ç¼“å­˜æ—¶é—´æˆ³
                const timestamp = response.headers.get('X-Cache-Timestamp');
                if (timestamp && isCacheExpired(parseInt(timestamp))) {
                    // ç¼“å­˜å·²è¿‡æœŸï¼Œåˆ é™¤å¹¶è¿”å›null
                    await audioCache.delete(cacheKey);
                    return null;
                }

                const blob = await response.blob();
                return URL.createObjectURL(blob);
            }
        } catch (error) {
            console.error('ä»Cache Storageè·å–éŸ³é¢‘å¤±è´¥:', error);
        }

        return null;
    }

    // ä¿å­˜éŸ³é¢‘åˆ°Cache Storage
    async function saveAudioToCache(text, blob) {
        if (!audioCache) return;

        try {
            const cacheKey = getCacheKey(text);

            // åˆ›å»ºå¸¦æœ‰æ—¶é—´æˆ³çš„å“åº”
            const response = new Response(blob, {
                headers: {
                    'Content-Type': blob.type || 'audio/mpeg',
                    'X-Cache-Timestamp': Date.now().toString()
                }
            });

            await audioCache.put(cacheKey, response);
            console.log('éŸ³é¢‘å·²ä¿å­˜åˆ°Cache Storage');
        } catch (error) {
            console.error('ä¿å­˜éŸ³é¢‘åˆ°Cache Storageå¤±è´¥:', error);
        }
    }

    // åˆå§‹åŒ–éŸ³é¢‘å…ƒç´ 
    function initializeAudioElements() {
        // æ¸…ç©ºå®¹å™¨
        audioContainer.innerHTML = '';
        audioElements = [];

        // ä¸ºæ¯ä¸ªåœºæ™¯åˆ›å»ºéŸ³é¢‘å…ƒç´ 
        scenes.forEach((scene, index) => {
            const audio = document.createElement('audio');
            audio.id = `audio-${index}`;
            audio.preload = 'auto';
            audioContainer.appendChild(audio);
            audioElements.push(audio);
        });
    }

    // åˆæˆå•ä¸ªåœºæ™¯çš„è¯­éŸ³
    async function synthesizeSceneSpeech(index) {
        const text = scenes[index].subtitle;

        // æ£€æŸ¥ç¼“å­˜
        const cachedAudioUrl = await getAudioFromCache(text);
        if (cachedAudioUrl) {
            // æ˜¾ç¤ºç¼“å­˜æŒ‡ç¤ºå™¨
            cacheIndicator.classList.add('active');
            setTimeout(() => {
                cacheIndicator.classList.remove('active');
            }, 2000);

            // ä½¿ç”¨ç¼“å­˜çš„éŸ³é¢‘
            audioElements[index].src = cachedAudioUrl;

            // ç­‰å¾…éŸ³é¢‘åŠ è½½å®Œæˆä»¥è·å–æ—¶é•¿
            return new Promise((resolve) => {
                audioElements[index].onloadedmetadata = () => {
                    scenes[index].duration = audioElements[index].duration * 1000; // è½¬æ¢ä¸ºæ¯«ç§’
                    resolve();
                };
            });
        }

        // ç¼“å­˜ä¸­æ²¡æœ‰ï¼Œè¯·æ±‚TTSæœåŠ¡
        try {
            const encodedText = encodeURIComponent(text);
            const response = await fetch(`https://javalinux.explanation.fun/tts?input=${encodedText}`);
            const blob = await response.blob();
            const audioUrl = URL.createObjectURL(blob);

            // ä¿å­˜åˆ°ç¼“å­˜
            await saveAudioToCache(text, blob);

            audioElements[index].src = audioUrl;

            // ç­‰å¾…éŸ³é¢‘åŠ è½½å®Œæˆä»¥è·å–æ—¶é•¿
            return new Promise((resolve) => {
                audioElements[index].onloadedmetadata = () => {
                    scenes[index].duration = audioElements[index].duration * 1000; // è½¬æ¢ä¸ºæ¯«ç§’
                    resolve();
                };
            });
        } catch (error) {
            console.error(`åœºæ™¯ ${index} TTSåˆæˆå¤±è´¥:`, error);
            // ä½¿ç”¨é»˜è®¤æŒç»­æ—¶é—´
            scenes[index].duration = 5000;
            return Promise.resolve();
        }
    }

    // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
    function formatTime(milliseconds) {
        const totalSeconds = Math.floor(milliseconds / 1000);
        const minutes = Math.floor(totalSeconds / 60);
        const seconds = totalSeconds % 60;
        return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    // æ›´æ–°æ—¶é—´æ˜¾ç¤º
    function updateTimeDisplay(currentTime, totalTime) {
        const currentTimeStr = formatTime(currentTime);
        const totalTimeStr = formatTime(totalTime);
        timeDisplay.textContent = `${currentTimeStr} / ${totalTimeStr}`;
    }

    // é¢„åŠ è½½æ‰€æœ‰éŸ³é¢‘
    async function preloadAllAudio() {
        loading.classList.add('active');
        playBtn.disabled = true;

        // åˆå§‹åŒ–Cache Storage
        await initCacheStorage();

        initializeAudioElements();

        // é¡ºåºåˆæˆæ¯ä¸ªåœºæ™¯çš„è¯­éŸ³
        for (let i = 0; i < scenes.length; i++) {
            await synthesizeSceneSpeech(i);
        }

        // è®¡ç®—æ—¶é—´æˆ³
        calculateTimestamps();

        // åˆå§‹åŒ–æ—¶é—´æ˜¾ç¤º
        updateTimeDisplay(0, totalDuration);

        loading.classList.remove('active');
        playBtn.disabled = false;
    }

    // è®¡ç®—æ¯ä¸ªåœºæ™¯çš„æ—¶é—´æˆ³
    function calculateTimestamps() {
        sceneTimestamps = [];
        let accumulatedTime = 0;

        scenes.forEach((scene) => {
            sceneTimestamps.push(accumulatedTime);
            accumulatedTime += scene.duration;
        });

        totalDuration = accumulatedTime;
    }

    // æ›´æ–°è¿›åº¦æ¡
    function updateProgress() {
        if (!isPlaying) return;

        const currentAudio = audioElements[currentScene];
        if (!currentAudio) return;

        // è®¡ç®—å½“å‰æ—¶é—´ç‚¹
        const sceneStartTime = sceneTimestamps[currentScene];
        const currentTime = sceneStartTime + (currentAudio.currentTime * 1000);
        const progress = Math.min((currentTime / totalDuration) * 100, 100);

        progressFill.style.width = progress + '%';
        progressHandle.style.left = progress + '%';

        // æ›´æ–°æ—¶é—´æ˜¾ç¤º
        updateTimeDisplay(currentTime, totalDuration);

        if (progress >= 100) {
            stopAnimation();
        } else {
            requestAnimationFrame(updateProgress);
        }
    }

    // æ’­æ”¾æŒ‡å®šåœºæ™¯
    function playScene(sceneIndex) {
        if (sceneIndex >= scenes.length) {
            stopAnimation();
            return;
        }

        // åœæ­¢å½“å‰éŸ³é¢‘
        if (currentScene < audioElements.length && audioElements[currentScene]) {
            audioElements[currentScene].pause();
        }

        currentScene = sceneIndex;
        const scene = scenes[sceneIndex];
        const audio = audioElements[sceneIndex];

        // æ›´æ–°å­—å¹•å’ŒåŠ¨ç”»
        subtitle.textContent = scene.subtitle;
        subtitle.classList.add('active');
        scene.action();

        // æ’­æ”¾éŸ³é¢‘
        if (audio && !isMuted) {
            audio.currentTime = 0;
            audio.play().catch(e => console.log('éŸ³é¢‘æ’­æ”¾å¤±è´¥:', e));

            // éŸ³é¢‘ç»“æŸæ—¶æ’­æ”¾ä¸‹ä¸€ä¸ªåœºæ™¯
            audio.onended = () => {
                subtitle.classList.remove('active');
                playScene(currentScene + 1);
            };
        } else {
            // å¦‚æœé™éŸ³æˆ–æ²¡æœ‰éŸ³é¢‘ï¼Œä½¿ç”¨å®šæ—¶å™¨
            setTimeout(() => {
                subtitle.classList.remove('active');
                playScene(currentScene + 1);
            }, scene.duration);
        }
    }

    // å¼€å§‹åŠ¨ç”»
    function startAnimation() {
        if (isPlaying) return;

        isPlaying = true;
        playIcon.textContent = 'â¸';

        if (wasPausedByUser && pausedScene < scenes.length) {
            // ä»æš‚åœçš„çŠ¶æ€æ¢å¤æ’­æ”¾
            const scene = scenes[pausedScene];
            const audio = audioElements[pausedScene];

            // æ›´æ–°å­—å¹•å’ŒåŠ¨ç”»
            subtitle.textContent = scene.subtitle;
            subtitle.classList.add('active');
            scene.action();

            // è®¾ç½®å½“å‰åœºæ™¯
            currentScene = pausedScene;

            // æ’­æ”¾éŸ³é¢‘ï¼ˆä»æš‚åœçš„æ—¶é—´ç‚¹å¼€å§‹ï¼‰
            if (audio && !isMuted) {
                audio.currentTime = pausedTime / 1000; // è½¬æ¢ä¸ºç§’
                audio.play().catch(e => console.log('éŸ³é¢‘æ’­æ”¾å¤±è´¥:', e));

                // éŸ³é¢‘ç»“æŸæ—¶æ’­æ”¾ä¸‹ä¸€ä¸ªåœºæ™¯
                audio.onended = () => {
                    subtitle.classList.remove('active');
                    playScene(currentScene + 1);
                };
            } else {
                // å¦‚æœé™éŸ³æˆ–æ²¡æœ‰éŸ³é¢‘ï¼Œä½¿ç”¨å®šæ—¶å™¨
                setTimeout(() => {
                    subtitle.classList.remove('active');
                    playScene(currentScene + 1);
                }, scene.duration - pausedTime);
            }

            wasPausedByUser = false;
        } else {
            // ä»å¤´å¼€å§‹æ’­æ”¾
            currentScene = 0;
            playScene(0);
        }

        updateProgress();
    }

    // æš‚åœåŠ¨ç”»
    function pauseAnimation() {
        isPlaying = false;
        playIcon.textContent = 'â–¶';
        wasPausedByUser = true;

        // ä¿å­˜å½“å‰æ’­æ”¾çŠ¶æ€
        if (currentScene < audioElements.length && audioElements[currentScene]) {
            const audio = audioElements[currentScene];
            pausedScene = currentScene;
            pausedTime = audio.currentTime * 1000; // è½¬æ¢ä¸ºæ¯«ç§’

            // æš‚åœå½“å‰éŸ³é¢‘
            audio.pause();
        }
    }

    // åœæ­¢åŠ¨ç”»
    function stopAnimation() {
        pauseAnimation();
        currentScene = 0;
        pausedScene = 0;
        pausedTime = 0;
        wasPausedByUser = false;
        progressFill.style.width = '0%';
        progressHandle.style.left = '0%';
        subtitle.textContent = '';

        // é‡ç½®æ—¶é—´æ˜¾ç¤º
        updateTimeDisplay(0, totalDuration);

        // éšè—æ‰€æœ‰åœºæ™¯
        for (let i = 1; i <= 6; i++) {
            document.getElementById(`scene${i}`).style.display = 'none';
        }

        // éšè—æ ‡é¢˜
        sceneTitle.classList.remove('active');
        // é‡ç½®åœºæ™¯ç¼–å·
        sceneNumber.textContent = '1';
    }

    // åˆ‡æ¢é™éŸ³
    function toggleMute() {
        isMuted = !isMuted;
        muteIcon.textContent = isMuted ? 'ğŸ”‡' : 'ğŸ”Š';

        // è®¾ç½®æ‰€æœ‰éŸ³é¢‘å…ƒç´ çš„é™éŸ³çŠ¶æ€
        audioElements.forEach(audio => {
            audio.muted = isMuted;
        });
    }

    // è¿›åº¦æ¡æ§åˆ¶
    function handleProgressClick(e) {
        const rect = progressBar.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const percentage = Math.max(0, Math.min(100, (x / rect.width) * 100));

        progressFill.style.width = percentage + '%';
        progressHandle.style.left = percentage + '%';

        // è®¡ç®—å¯¹åº”çš„æ—¶é—´ç‚¹
        const targetTime = (percentage / 100) * totalDuration;

        // æ›´æ–°æ—¶é—´æ˜¾ç¤º
        updateTimeDisplay(targetTime, totalDuration);

        // æ‰¾åˆ°å¯¹åº”çš„åœºæ™¯
        let targetScene = 0;
        for (let i = 0; i < sceneTimestamps.length; i++) {
            if (targetTime >= sceneTimestamps[i]) {
                targetScene = i;
            } else {
                break;
            }
        }

        // æ›´æ–°æš‚åœçŠ¶æ€
        pausedScene = targetScene;
        pausedTime = targetTime - sceneTimestamps[targetScene];

        // å¦‚æœæ­£åœ¨æ’­æ”¾ï¼Œè·³è½¬åˆ°ç›®æ ‡åœºæ™¯
        if (isPlaying) {
            // åœæ­¢å½“å‰éŸ³é¢‘
            if (currentScene < audioElements.length && audioElements[currentScene]) {
                audioElements[currentScene].pause();
            }

            // è®¡ç®—åœ¨ç›®æ ‡åœºæ™¯ä¸­çš„æ—¶é—´åç§»
            const sceneOffset = targetTime - sceneTimestamps[targetScene];

            // æ’­æ”¾ç›®æ ‡åœºæ™¯
            currentScene = targetScene;
            const scene = scenes[targetScene];
            const audio = audioElements[targetScene];

            // æ›´æ–°å­—å¹•å’ŒåŠ¨ç”»
            subtitle.textContent = scene.subtitle;
            subtitle.classList.add('active');
            scene.action();

            // æ’­æ”¾éŸ³é¢‘ï¼ˆä»æŒ‡å®šæ—¶é—´ç‚¹å¼€å§‹ï¼‰
            if (audio && !isMuted) {
                audio.currentTime = sceneOffset / 1000; // è½¬æ¢ä¸ºç§’
                audio.play().catch(e => console.log('éŸ³é¢‘æ’­æ”¾å¤±è´¥:', e));

                // éŸ³é¢‘ç»“æŸæ—¶æ’­æ”¾ä¸‹ä¸€ä¸ªåœºæ™¯
                audio.onended = () => {
                    subtitle.classList.remove('active');
                    playScene(currentScene + 1);
                };
            } else {
                // å¦‚æœé™éŸ³æˆ–æ²¡æœ‰éŸ³é¢‘ï¼Œä½¿ç”¨å®šæ—¶å™¨
                setTimeout(() => {
                    subtitle.classList.remove('active');
                    playScene(currentScene + 1);
                }, scene.duration - sceneOffset);
            }
        } else if (wasPausedByUser) {
            // å¦‚æœæ˜¯æš‚åœçŠ¶æ€ï¼Œæ›´æ–°åœºæ™¯æ˜¾ç¤ºä½†ä¸æ’­æ”¾
            currentScene = targetScene;
            const scene = scenes[targetScene];

            // æ›´æ–°å­—å¹•å’ŒåŠ¨ç”»
            subtitle.textContent = scene.subtitle;
            subtitle.classList.add('active');
            scene.action();
        }
    }

    // äº‹ä»¶ç›‘å¬
    playBtn.addEventListener('click', () => {
        if (isPlaying) {
            pauseAnimation();
        } else {
            startAnimation();
        }
    });

    muteBtn.addEventListener('click', toggleMute);
    progressBar.addEventListener('click', handleProgressClick);

    // è¿›åº¦æ¡æ‹–åŠ¨
    progressHandle.addEventListener('mousedown', () => isDragging = true);
    document.addEventListener('mousemove', (e) => {
        if (isDragging) {
            handleProgressClick(e);
        }
    });
    document.addEventListener('mouseup', () => {
        if (isDragging) {
            isDragging = false;
        }
    });

    // åˆå§‹åŒ–
    window.addEventListener('load', () => {
        preloadAllAudio();
    });
</script>
</body>
</html>