<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG + Three.js Ê∑∑ÂêàÁ§∫‰æã</title>
    <link rel="stylesheet" href="animation-player.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body class="main-container">
<div class="loading" id="loading">
    <div class="loading-spinner"></div>
    <div class="loading-text">Loading...</div>
</div>

<div class="animation-container">
    <div class="scene-number" id="sceneNumber">1</div>

    <svg class="trig-scene" viewBox="0 0 800 400">
        <!-- Âú∫ÊôØ 1: SVG Âú∫ÊôØ -->
        <g id="scene1">
            <circle cx="400" cy="200" r="80" fill="#3498db" opacity="0.3"/>
            <text x="400" y="210" text-anchor="middle" fill="#2c3e50" font-size="24">
                SVG 2D Âú∫ÊôØ
            </text>
        </g>

        <!-- Âú∫ÊôØ 2: Âè¶‰∏Ä‰∏™ SVG Âú∫ÊôØ -->
        <g id="scene2" style="display: none;">
            <rect x="300" y="150" width="200" height="100" fill="#e74c3c" opacity="0.3"/>
            <text x="400" y="210" text-anchor="middle" fill="#2c3e50" font-size="24">
                Âèà‰∏Ä‰∏™ SVG Âú∫ÊôØ
            </text>
        </g>

        <!-- Âú∫ÊôØ 3: ÂµåÂÖ• Canvas ÁöÑ 3D Âú∫ÊôØ -->
        <g id="scene3" style="display: none;">
            <foreignObject x="100" y="50" width="600" height="300">
                <div xmlns="http://www.w3.org/1999/xhtml" style="width: 600px; height: 300px;">
                    <canvas id="canvas3d" width="600" height="300"
                            style="display: block; border-radius: 10px; background: #f0f0f0;"></canvas>
                </div>
            </foreignObject>
            <text x="400" y="370" text-anchor="middle" fill="#2c3e50" font-size="18">
                Three.js 3D Á´ãÊñπ‰Ωì
            </text>
        </g>
    </svg>
</div>

<div class="subtitle-container">
    <div class="subtitle" id="subtitle"></div>
</div>

<div class="controls">
    <button class="control-btn" id="playBtn" title="Play">
        <span id="playIcon">‚ñ∂</span>
    </button>
    <div class="scene-buttons" id="sceneButtons"></div>
</div>

<div id="audioContainer"></div>

<!-- ÂºïÂÖ•‰Ω†ÁöÑÂ∑•ÂÖ∑Á±ª -->
<script>
    // ===== Êâ©Â±ïÁöÑ AnimationPlayer Á±ª =====
    class AnimationPlayerWith3D {
        constructor(config) {
            this.scenes = config.scenes || [];
            this.elements = config.elements || {};
            this.currentScene = 0;
            this.threejsScenes = new Map();
            this.activeAnimations = new Map();
        }

        init() {
            console.log('‚úÖ AnimationPlayerWith3D ÂàùÂßãÂåñÂÆåÊàê');
        }

        // ÂàùÂßãÂåñ 3D Âú∫ÊôØ
        init3DScene(sceneIndex, canvasId, setupCallback) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) {
                console.error(`‚ùå Canvas ${canvasId} Êú™ÊâæÂà∞`);
                return null;
            }

            if (this.threejsScenes.has(sceneIndex)) {
                console.log(`‚ÑπÔ∏è Âú∫ÊôØ ${sceneIndex} Â∑≤ÁªèÂàùÂßãÂåñËøá‰∫Ü`);
                return this.threejsScenes.get(sceneIndex);
            }

            console.log(`üîß Ê≠£Âú®ÂàùÂßãÂåñ 3D Âú∫ÊôØ ${sceneIndex}...`);

            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(
                75,
                canvas.width / canvas.height,
                0.1,
                1000
            );
            const renderer = new THREE.WebGLRenderer({
                canvas,
                antialias: true,
                alpha: true
            });

            renderer.setSize(canvas.width, canvas.height);
            camera.position.z = 5;

            // Ê∑ªÂä†ÂÖâÊ∫ê
            const ambientLight = new THREE.AmbientLight(0x404040);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(5, 5, 5);
            scene.add(directionalLight);

            const threeSetup = {
                scene,
                camera,
                renderer,
                objects: {}
            };

            if (setupCallback) {
                setupCallback(threeSetup);
            }

            this.threejsScenes.set(sceneIndex, threeSetup);
            console.log(`‚úÖ Âú∫ÊôØ ${sceneIndex} ÂàùÂßãÂåñÊàêÂäü!`, threeSetup);

            return threeSetup;
        }

        // ÂêØÂä® 3D Âä®Áîª
        start3DAnimation(sceneIndex, animateCallback) {
            const threeSetup = this.threejsScenes.get(sceneIndex);
            if (!threeSetup) {
                console.error(`‚ùå Âú∫ÊôØ ${sceneIndex} Êú™ÂàùÂßãÂåñ`);
                return;
            }

            this.stop3DAnimation(sceneIndex);

            const animate = () => {
                const animationId = requestAnimationFrame(animate);
                this.activeAnimations.set(sceneIndex, animationId);

                if (animateCallback) {
                    animateCallback(threeSetup);
                }

                threeSetup.renderer.render(threeSetup.scene, threeSetup.camera);
            };

            console.log(`‚ñ∂Ô∏è ÂêØÂä®Âú∫ÊôØ ${sceneIndex} ÁöÑ 3D Âä®Áîª`);
            animate();
        }

        // ÂÅúÊ≠¢ 3D Âä®Áîª
        stop3DAnimation(sceneIndex) {
            const animationId = this.activeAnimations.get(sceneIndex);
            if (animationId) {
                cancelAnimationFrame(animationId);
                this.activeAnimations.delete(sceneIndex);
                console.log(`‚è∏Ô∏è ÂÅúÊ≠¢Âú∫ÊôØ ${sceneIndex} ÁöÑ 3D Âä®Áîª`);
            }
        }

        // Êí≠ÊîæÂú∫ÊôØ (Ëá™Âä®Â§ÑÁêÜ 3D ÂàùÂßãÂåñ)
        playScene(sceneIndex) {
            console.log(`\nüé¨ Êí≠ÊîæÂú∫ÊôØ ${sceneIndex}`);

            // ÂÅúÊ≠¢ÊâÄÊúâ 3D Âä®Áîª
            this.activeAnimations.forEach((_, index) => {
                this.stop3DAnimation(index);
            });

            // ÈöêËóèÊâÄÊúâÂú∫ÊôØ
            for (let i = 0; i < this.scenes.length; i++) {
                const sceneElement = document.getElementById(`scene${i + 1}`);
                if (sceneElement) {
                    sceneElement.style.display = 'none';
                }
            }

            // ÊòæÁ§∫ÂΩìÂâçÂú∫ÊôØ
            const currentSceneElement = document.getElementById(`scene${sceneIndex + 1}`);
            if (currentSceneElement) {
                currentSceneElement.style.display = 'block';
            }

            this.currentScene = sceneIndex;
            const scene = this.scenes[sceneIndex];

            // Êõ¥Êñ∞Â≠óÂπï
            const subtitle = document.getElementById('subtitle');
            if (subtitle) {
                subtitle.textContent = scene.subtitle;
                subtitle.classList.add('active');
            }

            // Êõ¥Êñ∞Âú∫ÊôØÁºñÂè∑
            const sceneNumber = document.getElementById('sceneNumber');
            if (sceneNumber) {
                sceneNumber.textContent = sceneIndex + 1;
            }

            // ÊâßË°åÂú∫ÊôØÁöÑ action
            if (scene.action) {
                scene.action();
            }

            // üéØ Ëá™Âä®Â§ÑÁêÜ 3D Âú∫ÊôØ
            if (scene.is3D) {
                console.log(`üéÆ ËøôÊòØ‰∏Ä‰∏™ 3D Âú∫ÊôØ`);

                if (!this.threejsScenes.has(sceneIndex)) {
                    console.log(`üîß Âú∫ÊôØÊú™ÂàùÂßãÂåñ,ÂºÄÂßãËá™Âä®ÂàùÂßãÂåñ...`);

                    const canvasId = scene.canvasId || 'canvas3d';

                    if (scene.setup3D) {
                        this.init3DScene(sceneIndex, canvasId, scene.setup3D);
                    } else {
                        console.error(`‚ùå Âú∫ÊôØ ${sceneIndex} Áº∫Â∞ë setup3D ÊñπÊ≥ï`);
                        return;
                    }
                }

                if (scene.animate3D) {
                    this.start3DAnimation(sceneIndex, scene.animate3D);
                }
            }
        }

        setSceneButtons(container) {
            if (!container) return;

            container.innerHTML = '';
            this.scenes.forEach((scene, idx) => {
                const btn = document.createElement('button');
                btn.className = 'scene-btn';
                btn.textContent = String(idx + 1);
                btn.addEventListener('click', () => {
                    this.playScene(idx);
                    this.highlightActiveSceneButton(idx);
                });
                container.appendChild(btn);
            });

            this.highlightActiveSceneButton(0);
        }

        highlightActiveSceneButton(index) {
            const buttons = document.querySelectorAll('.scene-btn');
            buttons.forEach((b, i) => b.classList.toggle('active', i === index));
        }
    }

    // ===== Âú∫ÊôØÂÆö‰πâ =====
    const demoScenes = [
        {
            title: "Âú∫ÊôØ 1 - SVG ÂúÜÂΩ¢",
            subtitle: "ËøôÊòØ‰∏Ä‰∏™ÁÆÄÂçïÁöÑ SVG 2D Âú∫ÊôØ",
            action: () => console.log('Âú∫ÊôØ 1 ÊâßË°å')
        },
        {
            title: "Âú∫ÊôØ 2 - SVG Áü©ÂΩ¢",
            subtitle: "Âèà‰∏Ä‰∏™ SVG 2D Âú∫ÊôØ",
            action: () => console.log('Âú∫ÊôØ 2 ÊâßË°å')
        },
        {
            title: "Âú∫ÊôØ 3 - Three.js 3D",
            subtitle: "ËøôÊòØ‰∏Ä‰∏™ÁúüÊ≠£ÁöÑ 3D Âú∫ÊôØ,‰ºöËá™Âä®ÂàùÂßãÂåñ",
            is3D: true,
            canvasId: 'canvas3d',

            // ‚úÖ ÂàùÂßãÂåñÈÄªËæë
            setup3D: (setup) => {
                console.log('üé® ÂºÄÂßãÂàõÂª∫ 3D ÂØπË±°...');

                const geometry = new THREE.BoxGeometry(2, 2, 2);
                const materials = [
                    new THREE.MeshPhongMaterial({ color: 0xff0000 }),
                    new THREE.MeshPhongMaterial({ color: 0x00ff00 }),
                    new THREE.MeshPhongMaterial({ color: 0x0000ff }),
                    new THREE.MeshPhongMaterial({ color: 0xffff00 }),
                    new THREE.MeshPhongMaterial({ color: 0xff00ff }),
                    new THREE.MeshPhongMaterial({ color: 0x00ffff })
                ];

                const cube = new THREE.Mesh(geometry, materials);
                setup.scene.add(cube);
                setup.objects.cube = cube;

                console.log('‚úÖ 3D Á´ãÊñπ‰ΩìÂàõÂª∫ÊàêÂäü');
            },

            // ‚úÖ Âä®ÁîªÈÄªËæë
            animate3D: (setup) => {
                if (setup.objects.cube) {
                    setup.objects.cube.rotation.x += 0.01;
                    setup.objects.cube.rotation.y += 0.01;
                }
            },

            action: () => console.log('Âú∫ÊôØ 3 ÊâßË°å (3D ‰ºöËá™Âä®Â§ÑÁêÜ)')
        }
    ];

    // ===== ÂàùÂßãÂåñ =====
    const player = new AnimationPlayerWith3D({
        scenes: demoScenes
    });

    player.init();
    player.setSceneButtons(document.getElementById('sceneButtons'));
    player.playScene(0);

    // Êí≠ÊîæÊåâÈíÆ
    document.getElementById('playBtn').addEventListener('click', () => {
        const nextScene = (player.currentScene + 1) % demoScenes.length;
        player.playScene(nextScene);
    });

    window.mathPlayer = player;
</script>

<style>
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        margin: 0;
        padding: 20px;
    }

    .main-container {
        max-width: 1000px;
        margin: 0 auto;
        width: 100%;
    }

    .animation-container {
        background: white;
        border-radius: 20px;
        padding: 20px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        margin-bottom: 20px;
        min-height: 450px;
        position: relative;
    }

    .scene-number {
        position: absolute;
        top: 20px;
        right: 20px;
        background: #3498db;
        color: white;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        font-weight: bold;
    }

    .trig-scene {
        width: 100%;
        height: 400px;
    }

    .subtitle-container {
        background: white;
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    .subtitle {
        text-align: center;
        font-size: 1.2rem;
        color: #2c3e50;
    }

    .controls {
        display: flex;
        gap: 15px;
        align-items: center;
        justify-content: center;
        flex-wrap: wrap;
    }

    .control-btn {
        width: 50px;
        height: 50px;
        border: none;
        border-radius: 50%;
        background: #3498db;
        color: white;
        font-size: 1.2rem;
        cursor: pointer;
        transition: all 0.3s;
    }

    .control-btn:hover {
        background: #2980b9;
        transform: scale(1.1);
    }

    .scene-buttons {
        display: flex;
        gap: 10px;
    }

    .scene-btn {
        padding: 8px 16px;
        border: 2px solid #3498db;
        border-radius: 8px;
        background: white;
        color: #3498db;
        cursor: pointer;
        font-size: 1rem;
        transition: all 0.3s;
    }

    .scene-btn:hover {
        background: #3498db;
        color: white;
    }

    .scene-btn.active {
        background: #3498db;
        color: white;
        font-weight: bold;
    }
</style>
</body>
</html>