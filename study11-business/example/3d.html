<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG vs Canvas 3D 对比</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: white;
            font-size: 2.5rem;
            margin-bottom: 40px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .demo-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .demo-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .demo-subtitle {
            color: #7f8c8d;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .canvas-container, .svg-container {
            width: 100%;
            height: 300px;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
            background: #f8f9fa;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        svg {
            width: 100%;
            height: 100%;
        }

        .status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.fail {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.partial {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .conclusion {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .conclusion h2 {
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .conclusion ul {
            line-height: 1.8;
            color: #34495e;
        }

        .conclusion li {
            margin-bottom: 10px;
        }

        .emoji {
            font-size: 1.2em;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>🔬 SVG vs Canvas 3D 能力实验</h1>

    <div class="comparison">
        <!-- Canvas 2D - 伪3D -->
        <div class="demo-card">
            <div class="demo-title">1. Canvas 2D - 手动 3D 投影</div>
            <div class="demo-subtitle">需要自己计算透视投影</div>
            <div class="canvas-container">
                <canvas id="canvas2d"></canvas>
            </div>
            <div class="status partial">
                <span class="emoji">⚠️</span> <strong>部分支持:</strong> 需手动实现所有 3D 数学计算(旋转矩阵、投影等)
            </div>
        </div>

        <!-- Canvas WebGL/Three.js -->
        <div class="demo-card">
            <div class="demo-title">2. Canvas + WebGL (Three.js)</div>
            <div class="demo-subtitle">真正的 3D 引擎</div>
            <div class="canvas-container">
                <canvas id="canvasWebGL"></canvas>
            </div>
            <div class="status success">
                <span class="emoji">✅</span> <strong>完全支持:</strong> 硬件加速的真 3D，性能强大
            </div>
        </div>

        <!-- SVG + CSS 3D Transform -->
        <div class="demo-card">
            <div class="demo-title">3. SVG + CSS 3D Transform</div>
            <div class="demo-subtitle">尝试用 CSS 变换</div>
            <div class="svg-container">
                <svg viewBox="0 0 400 300">
                    <g id="svgCss3d" style="transform-style: preserve-3d;">
                        <rect x="150" y="100" width="100" height="100" fill="#3498db" />
                        <text x="175" y="160" fill="white" font-size="20">CSS 3D?</text>
                    </g>
                </svg>
            </div>
            <div class="status fail">
                <span class="emoji">❌</span> <strong>不支持:</strong> SVG 不支持 transform-style: preserve-3d
            </div>
        </div>

        <!-- SVG foreignObject + CSS 3D -->
        <div class="demo-card">
            <div class="demo-title">4. SVG foreignObject + CSS 3D</div>
            <div class="demo-subtitle">在 foreignObject 中尝试 3D</div>
            <div class="svg-container">
                <svg viewBox="0 0 400 300">
                    <foreignObject x="100" y="50" width="200" height="200">
                        <div xmlns="http://www.w3.org/1999/xhtml"
                             id="foreignObject3d"
                             style="width: 200px; height: 200px;
                                        background: #e74c3c;
                                        display: flex;
                                        align-items: center;
                                        justify-content: center;
                                        color: white;
                                        font-size: 20px;
                                        perspective: 500px;
                                        transform-style: preserve-3d;">
                            <div style="transform: rotateY(0deg);">
                                Foreign 3D?
                            </div>
                        </div>
                    </foreignObject>
                </svg>
            </div>
            <div class="status fail">
                <span class="emoji">❌</span> <strong>不可靠:</strong> 跨浏览器兼容性差，行为不一致
            </div>
        </div>
    </div>

    <div class="conclusion">
        <h2>📊 结论与建议</h2>
        <ul>
            <li><strong>Canvas 2D:</strong> 可以做伪 3D，但需要手写大量数学代码，不推荐</li>
            <li><strong>Canvas + WebGL (Three.js):</strong> <span class="emoji">🏆</span> <strong>真 3D 的唯一选择</strong>，性能强大，生态完善</li>
            <li><strong>SVG + CSS 3D:</strong> 不支持 preserve-3d，无法实现真正的 3D 空间</li>
            <li><strong>foreignObject + CSS 3D:</strong> 理论上可能但极不可靠，不同浏览器表现不一致</li>
        </ul>

        <h2 style="margin-top: 30px;">💡 针对你的项目</h2>
        <ul>
            <li><strong>如果需要 3D:</strong> 必须使用 <code>canvas + Three.js</code></li>
            <li><strong>如果不需要 3D:</strong> 继续用 SVG，它更适合你当前的 2D 图表</li>
            <li><strong>混合方案:</strong> 某些场景用 Three.js (canvas)，其他场景用 SVG</li>
        </ul>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
    // 1. Canvas 2D - 手动 3D 投影
    const canvas2d = document.getElementById('canvas2d');
    const ctx = canvas2d.getContext('2d');
    canvas2d.width = canvas2d.offsetWidth;
    canvas2d.height = canvas2d.offsetHeight;

    let angle2d = 0;
    function draw2DCube() {
        ctx.clearRect(0, 0, canvas2d.width, canvas2d.height);

        const centerX = canvas2d.width / 2;
        const centerY = canvas2d.height / 2;
        const size = 60;

        // 简单的旋转矩阵(仅绕 Y 轴)
        const cos = Math.cos(angle2d);
        const sin = Math.sin(angle2d);

        // 立方体顶点
        const vertices = [
            [-1, -1, -1], [1, -1, -1], [1, 1, -1], [-1, 1, -1],
            [-1, -1, 1], [1, -1, 1], [1, 1, 1], [-1, 1, 1]
        ];

        // 投影顶点
        const projected = vertices.map(v => {
            const x = v[0] * cos - v[2] * sin;
            const z = v[0] * sin + v[2] * cos;
            const scale = 200 / (200 + z * 50);
            return [
                centerX + x * size * scale,
                centerY + v[1] * size * scale
            ];
        });

        // 绘制边
        ctx.strokeStyle = '#3498db';
        ctx.lineWidth = 2;
        const edges = [
            [0,1],[1,2],[2,3],[3,0],
            [4,5],[5,6],[6,7],[7,4],
            [0,4],[1,5],[2,6],[3,7]
        ];

        edges.forEach(([a, b]) => {
            ctx.beginPath();
            ctx.moveTo(projected[a][0], projected[a][1]);
            ctx.lineTo(projected[b][0], projected[b][1]);
            ctx.stroke();
        });

        angle2d += 0.02;
        requestAnimationFrame(draw2DCube);
    }
    draw2DCube();

    // 2. Canvas WebGL (Three.js)
    const canvasWebGL = document.getElementById('canvasWebGL');
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, canvasWebGL.offsetWidth / canvasWebGL.offsetHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ canvas: canvasWebGL, antialias: true });
    renderer.setSize(canvasWebGL.offsetWidth, canvasWebGL.offsetHeight);

    const geometry = new THREE.BoxGeometry(2, 2, 2);
    const material = new THREE.MeshPhongMaterial({ color: 0x2ecc71 });
    const cube = new THREE.Mesh(geometry, material);
    scene.add(cube);

    const light = new THREE.DirectionalLight(0xffffff, 1);
    light.position.set(5, 5, 5);
    scene.add(light);
    scene.add(new THREE.AmbientLight(0x404040));

    camera.position.z = 5;

    function animateWebGL() {
        requestAnimationFrame(animateWebGL);
        cube.rotation.x += 0.01;
        cube.rotation.y += 0.01;
        renderer.render(scene, camera);
    }
    animateWebGL();

    // 3. SVG CSS 3D (会失败)
    const svgCss3d = document.getElementById('svgCss3d');
    let angle3d = 0;
    function animateSvgCss() {
        angle3d += 1;
        svgCss3d.style.transform = `rotateY(${angle3d}deg)`;
        requestAnimationFrame(animateSvgCss);
    }
    animateSvgCss();

    // 4. foreignObject 3D (可能部分工作)
    const foreign3d = document.getElementById('foreignObject3d');
    let angle4 = 0;
    function animateForeign() {
        angle4 += 1;
        const innerDiv = foreign3d.querySelector('div');
        if (innerDiv) {
            innerDiv.style.transform = `rotateY(${angle4}deg)`;
        }
        requestAnimationFrame(animateForeign);
    }
    animateForeign();
</script>
</body>
</html>