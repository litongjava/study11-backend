<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>三角函数动画教学</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .main-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            padding: 20px;
        }
        .animation-container {
            flex: 1;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            padding: 30px;
            position: relative;
            overflow: hidden;
            min-height: 500px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .subtitle-container {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            margin: 15px 0;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .subtitle {
            color: #2c3e50;
            border-radius: 30px;
            font-size: 1.3rem;
            max-width: 85%;
            text-align: center;
            line-height: 1.6;
            opacity: 0;
            transition: opacity 0.3s ease;
            padding: 15px 25px;
        }
        .subtitle.active {
            opacity: 1;
        }
        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 10px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        .control-btn {
            width: 55px;
            height: 55px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 1.3rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        .control-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        .control-btn:active {
            transform: scale(0.95);
        }
        .control-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }
        .progress-container {
            flex: 1;
            max-width: 400px;
            margin: 0 20px;
            display: flex;
            align-items: center;
        }
        .progress-bar {
            flex: 1;
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            cursor: pointer;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 5px;
            width: 0%;
            transition: width 0.1s ease;
        }
        .progress-handle {
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 22px;
            height: 22px;
            background: white;
            border: 3px solid #667eea;
            border-radius: 50%;
            cursor: grab;
            left: 0%;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        .progress-handle:active {
            cursor: grabbing;
        }
        .time-display {
            min-width: 100px;
            text-align: center;
            font-size: 0.95rem;
            color: #2c3e50;
            font-weight: 600;
        }
        .footer {
            text-align: center;
            padding: 20px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }
        .loading.active {
            display: flex;
        }
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 6px solid rgba(102, 126, 234, 0.2);
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 20px;
        }
        .loading-text {
            font-size: 1.3rem;
            color: #667eea;
            font-weight: 600;
        }
        .cache-indicator {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(46, 204, 113, 0.9);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            display: none;
            font-weight: 600;
        }
        .cache-indicator.active {
            display: block;
        }
        .scene-number {
            position: absolute;
            top: 25px;
            right: 25px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            font-weight: bold;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .math-scene {
            width: 100%;
            height: 100%;
            position: relative;
        }
        .scene-title {
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2rem;
            color: #2c3e50;
            font-weight: 400;
            text-align: center;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        .scene-title.active {
            opacity: 1;
        }
        .equation-display {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 25px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            font-size: 1.4rem;
            color: #2c3e50;
            font-weight: 600;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        .equation-display.active {
            opacity: 1;
        }
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        @keyframes wave {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        .rotating {
            animation: rotate 4s linear infinite;
        }
        .pulsing {
            animation: wave 2s ease-in-out infinite;
        }
        @media (max-width: 768px) {
            .animation-container {
                padding: 15px;
                min-height: 350px;
            }
            
            .subtitle {
                font-size: 1rem;
                padding: 12px 20px;
            }
            
            .control-btn {
                width: 50px;
                height: 50px;
                font-size: 1.1rem;
            }
            
            .scene-title {
                font-size: 1.5rem;
            }
            
            .scene-number {
                width: 40px;
                height: 40px;
                font-size: 1.4rem;
            }
            
            .equation-display {
                font-size: 1.1rem;
                padding: 12px 20px;
            }
            
            .time-display {
                min-width: 80px;
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="animation-container">
            <div class="loading" id="loading">
                <div class="loading-spinner"></div>
                <div class="loading-text">加载中...</div>
            </div>
            <div class="cache-indicator" id="cacheIndicator">使用缓存音频</div>
            <div class="scene-number" id="sceneNumber">1</div>
            
            <svg class="math-scene" viewBox="0 0 800 500">
                <defs>
                    <pattern id="grid" width="30" height="30" patternUnits="userSpaceOnUse">
                        <path d="M 30 0 L 0 0 0 30" fill="none" stroke="#f0f0f0" stroke-width="1"/>
                    </pattern>
                    
                    <linearGradient id="circleGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
                    </linearGradient>
                    
                    <linearGradient id="waveGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#e74c3c;stop-opacity:1" />
                        <stop offset="50%" style="stop-color:#f39c12;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#e74c3c;stop-opacity:1" />
                    </linearGradient>
                    
                    <linearGradient id="lineGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#2ecc71;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#27ae60;stop-opacity:1" />
                    </linearGradient>
                </defs>
                
                <rect width="800" height="500" fill="url(#grid)" />
                
                <text x="800" y="30" text-anchor="middle" fill="#2c3e50" font-size="24" font-weight="300" class="scene-title" id="sceneTitle">
                    三角函数简介
                </text>
                
                <!-- Scene 1: Introduction -->
                <g id="scene1">
                    <!-- Unit Circle -->
                    <circle cx="200" cy="250" r="120" fill="none" stroke="url(#circleGradient)" stroke-width="3"/>
                    <line x1="80" y1="250" x2="320" y2="250" stroke="#34495e" stroke-width="2"/>
                    <line x1="200" y1="130" x2="200" y2="370" stroke="#34495e" stroke-width="2"/>
                    
                    <!-- Rotating point -->
                    <circle cx="320" cy="250" r="8" fill="#e74c3c">
                        <animateTransform attributeName="transform" type="rotate" from="0 200 250" to="360 200 250" dur="8s" repeatCount="indefinite"/>
                    </circle>
                    
                    <!-- Radius line -->
                    <line x1="200" y1="250" x2="320" y2="250" stroke="#e74c3c" stroke-width="3">
                        <animateTransform attributeName="transform" type="rotate" from="0 200 250" to="360 200 250" dur="8s" repeatCount="indefinite"/>
                    </line>
                    
                    <!-- Labels -->
                    <text x="200" y="400" text-anchor="middle" fill="#2c3e50" font-size="16">单位圆</text>
                    <text x="330" y="270" fill="#e74c3c" font-size="14">r = 1</text>
                    
                    <!-- Right side: Basic functions -->
                    <text x="500" y="150" text-anchor="middle" fill="#2c3e50" font-size="18" font-weight="600">基本三角函数</text>
                    <text x="450" y="200" fill="#2c3e50" font-size="16">sin θ = y / r</text>
                    <text x="450" y="230" fill="#2c3e50" font-size="16">cos θ = x / r</text>
                    <text x="450" y="260" fill="#2c3e50" font-size="16">tan θ = y / x</text>
                </g>
                
                <!-- Scene 2: Sine Function -->
                <g id="scene2" style="display: none;">
                    <!-- Coordinate system -->
                    <line x1="50" y1="250" x2="750" y2="250" stroke="#34495e" stroke-width="2"/>
                    <line x1="100" y1="50" x2="100" y2="450" stroke="#34495e" stroke-width="2"/>
                    
                    <!-- Sine wave -->
                    <path d="M 100 250 Q 175 150 250 250 T 400 250 T 550 250 T 700 250" 
                          fill="none" stroke="url(#waveGradient)" stroke-width="4">
                        <animate attributeName="d" 
                                values="M 100 250 Q 175 150 250 250 T 400 250 T 550 250 T 700 250;
                                        M 100 250 Q 175 350 250 250 T 400 250 T 550 250 T 700 250;
                                        M 100 250 Q 175 150 250 250 T 400 250 T 550 250 T 700 250"
                                dur="4s" repeatCount="indefinite"/>
                    </path>
                    
                    <!-- Unit circle on the left -->
                    <circle cx="200" cy="150" r="60" fill="none" stroke="url(#circleGradient)" stroke-width="2"/>
                    <circle cx="260" cy="150" r="6" fill="#e74c3c">
                        <animateTransform attributeName="transform" type="rotate" from="0 200 150" to="360 200 150" dur="4s" repeatCount="indefinite"/>
                    </circle>
                    
                    <!-- Y-axis labels -->
                    <text x="85" y="140" text-anchor="end" fill="#2c3e50" font-size="14">1</text>
                    <text x="85" y="255" text-anchor="end" fill="#2c3e50" font-size="14">0</text>
                    <text x="85" y="360" text-anchor="end" fill="#2c3e50" font-size="14">-1</text>
                    
                    <!-- X-axis labels -->
                    <text x="250" y="275" text-anchor="middle" fill="#2c3e50" font-size="14">π/2</text>
                    <text x="400" y="275" text-anchor="middle" fill="#2c3e50" font-size="14">π</text>
                    <text x="550" y="275" text-anchor="middle" fill="#2c3e50" font-size="14">3π/2</text>
                    <text x="700" y="275" text-anchor="middle" fill="#2c3e50" font-size="14">2π</text>
                    
                    <text x="400" y="50" text-anchor="middle" fill="#2c3e50" font-size="20" font-weight="600">正弦函数 y = sin x</text>
                </g>
                
                <!-- Scene 3: Cosine Function -->
                <g id="scene3" style="display: none;">
                    <!-- Coordinate system -->
                    <line x1="50" y1="250" x2="750" y2="250" stroke="#34495e" stroke-width="2"/>
                    <line x1="100" y1="50" x2="100" y2="450" stroke="#34495e" stroke-width="2"/>
                    
                    <!-- Cosine wave -->
                    <path d="M 100 150 Q 175 250 250 350 T 400 150 T 550 350 T 700 150" 
                          fill="none" stroke="url(#lineGradient)" stroke-width="4">
                        <animate attributeName="d" 
                                values="M 100 150 Q 175 250 250 350 T 400 150 T 550 350 T 700 150;
                                        M 100 350 Q 175 250 250 150 T 400 350 T 550 150 T 700 350;
                                        M 100 150 Q 175 250 250 350 T 400 150 T 550 350 T 700 150"
                                dur="4s" repeatCount="indefinite"/>
                    </path>
                    
                    <!-- Unit circle -->
                    <circle cx="200" cy="120" r="60" fill="none" stroke="url(#circleGradient)" stroke-width="2"/>
                    <circle cx="260" cy="120" r="6" fill="#2ecc71">
                        <animateTransform attributeName="transform" type="rotate" from="0 200 120" to="360 200 120" dur="4s" repeatCount="indefinite"/>
                    </circle>
                    
                    <!-- Labels -->
                    <text x="85" y="155" text-anchor="end" fill="#2c3e50" font-size="14">1</text>
                    <text x="85" y="255" text-anchor="end" fill="#2c3e50" font-size="14">0</text>
                    <text x="85" y="355" text-anchor="end" fill="#2c3e50" font-size="14">-1</text>
                    
                    <text x="250" y="275" text-anchor="middle" fill="#2c3e50" font-size="14">π/2</text>
                    <text x="400" y="275" text-anchor="middle" fill="#2c3e50" font-size="14">π</text>
                    <text x="550" y="275" text-anchor="middle" fill="#2c3e50" font-size="14">3π/2</text>
                    <text x="700" y="275" text-anchor="middle" fill="#2c3e50" font-size="14">2π</text>
                    
                    <text x="400" y="50" text-anchor="middle" fill="#2c3e50" font-size="20" font-weight="600">余弦函数 y = cos x</text>
                </g>
                
                <!-- Scene 4: Tangent Function -->
                <g id="scene4" style="display: none;">
                    <!-- Coordinate system -->
                    <line x1="50" y1="250" x2="750" y2="250" stroke="#34495e" stroke-width="2"/>
                    <line x1="100" y1="50" x2="100" y2="450" stroke="#34495e" stroke-width="2"/>
                    
                    <!-- Asymptotes -->
                    <line x1="250" y1="50" x2="250" y2="450" stroke="#e74c3c" stroke-width="2" stroke-dasharray="5,5" opacity="0.7"/>
                    <line x1="550" y1="50" x2="550" y2="450" stroke="#e74c3c" stroke-width="2" stroke-dasharray="5,5" opacity="0.7"/>
                    
                    <!-- Tangent curves -->
                    <path d="M 120 350 Q 200 250 230 50" fill="none" stroke="#f39c12" stroke-width="3"/>
                    <path d="M 270 350 Q 350 250 380 50" fill="none" stroke="#f39c12" stroke-width="3"/>
                    <path d="M 420 350 Q 500 250 530 50" fill="none" stroke="#f39c12" stroke-width="3"/>
                    <path d="M 570 350 Q 650 250 680 50" fill="none" stroke="#f39c12" stroke-width="3"/>
                    
                    <!-- Labels -->
                    <text x="85" y="155" text-anchor="end" fill="#2c3e50" font-size="14">1</text>
                    <text x="85" y="255" text-anchor="end" fill="#2c3e50" font-size="14">0</text>
                    <text x="85" y="355" text-anchor="end" fill="#2c3e50" font-size="14">-1</text>
                    
                    <text x="175" y="275" text-anchor="middle" fill="#2c3e50" font-size="14">π/4</text>
                    <text x="250" y="275" text-anchor="middle" fill="#e74c3c" font-size="14">π/2</text>
                    <text x="325" y="275" text-anchor="middle" fill="#2c3e50" font-size="14">3π/4</text>
                    <text x="400" y="275" text-anchor="middle" fill="#2c3e50" font-size="14">π</text>
                    
                    <text x="400" y="50" text-anchor="middle" fill="#2c3e50" font-size="20" font-weight="600">正切函数 y = tan x</text>
                    <text x="260" y="480" text-anchor="middle" fill="#e74c3c" font-size="12">渐近线</text>
                </g>
                
                <!-- Scene 5: Function Properties -->
                <g id="scene5" style="display: none;">
                    <!-- Three function comparison -->
                    <line x1="50" y1="250" x2="750" y2="250" stroke="#34495e" stroke-width="2"/>
                    <line x1="100" y1="50" x2="100" y2="450" stroke="#34495e" stroke-width="2"/>
                    
                    <!-- Sine wave -->
                    <path d="M 100 250 Q 200 150 300 250 T 500 250 T 700 250" 
                          fill="none" stroke="#e74c3c" stroke-width="3" opacity="0.8"/>
                    
                    <!-- Cosine wave -->
                    <path d="M 100 150 Q 200 250 300 350 T 500 150 T 700 350" 
                          fill="none" stroke="#2ecc71" stroke-width="3" opacity="0.8"/>
                    
                    <!-- Legend -->
                    <rect x="500" y="80" width="200" height="120" fill="rgba(255,255,255,0.9)" stroke="#ddd" rx="10"/>
                    <line x1="520" y1="110" x2="560" y2="110" stroke="#e74c3c" stroke-width="3"/>
                    <text x="570" y="115" fill="#2c3e50" font-size="14">sin x</text>
                    
                    <line x1="520" y1="140" x2="560" y2="140" stroke="#2ecc71" stroke-width="3"/>
                    <text x="570" y="145" fill="#2c3e50" font-size="14">cos x</text>
                    
                    <text x="600" y="175" text-anchor="middle" fill="#2c3e50" font-size="12">周期: 2π</text>
                    
                    <!-- Properties text -->
                    <text x="400" y="380" text-anchor="middle" fill="#2c3e50" font-size="16">sin²x + cos²x = 1</text>
                    <text x="400" y="410" text-anchor="middle" fill="#2c3e50" font-size="16">tan x = sin x / cos x</text>
                </g>
                
                <!-- Scene 6: Real Applications -->
                <g id="scene6" style="display: none;">
                    <!-- Sound wave visualization -->
                    <text x="400" y="80" text-anchor="middle" fill="#2c3e50" font-size="20" font-weight="600">三角函数的实际应用</text>
                    
                    <!-- Sound wave -->
                    <text x="150" y="140" text-anchor="middle" fill="#2c3e50" font-size="16">声波</text>
                    <path d="M 50 160 Q 100 140 150 160 T 250 160 T 350 160" 
                          fill="none" stroke="#3498db" stroke-width="3">
                        <animate attributeName="d" 
                                values="M 50 160 Q 100 140 150 160 T 250 160 T 350 160;
                                        M 50 160 Q 100 180 150 160 T 250 160 T 350 160;
                                        M 50 160 Q 100 140 150 160 T 250 160 T 350 160"
                                dur="2s" repeatCount="indefinite"/>
                    </path>
                    
                    <!-- Light wave -->
                    <text x="550" y="140" text-anchor="middle" fill="#2c3e50" font-size="16">光波</text>
                    <path d="M 450 160 Q 500 140 550 160 T 650 160 T 750 160" 
                          fill="none" stroke="#f39c12" stroke-width="3">
                        <animate attributeName="d" 
                                values="M 450 160 Q 500 140 550 160 T 650 160 T 750 160;
                                        M 450 160 Q 500 180 550 160 T 650 160 T 750 160;
                                        M 450 160 Q 500 140 550 160 T 650 160 T 750 160"
                                dur="1.5s" repeatCount="indefinite"/>
                    </path>
                    
                    <!-- Pendulum -->
                    <text x="200" y="240" text-anchor="middle" fill="#2c3e50" font-size="16">钟摆运动</text>
                    <line x1="200" y1="250" x2="200" y2="320" stroke="#34495e" stroke-width="2">
                        <animateTransform attributeName="transform" type="rotate" 
                                        values="0 200 250; 30 200 250; 0 200 250; -30 200 250; 0 200 250"
                                        dur="4s" repeatCount="indefinite"/>
                    </line>
                    <circle cx="200" cy="320" r="12" fill="#e74c3c">
                        <animateTransform attributeName="transform" type="rotate" 
                                        values="0 200 250; 30 200 250; 0 200 250; -30 200 250; 0 200 250"
                                        dur="4s" repeatCount="indefinite"/>
                    </circle>
                    
                    <!-- Circular motion -->
                    <text x="550" y="240" text-anchor="middle" fill="#2c3e50" font-size="16">圆周运动</text>
                    <circle cx="550" cy="290" r="40" fill="none" stroke="#34495e" stroke-width="2"/>
                    <circle cx="590" cy="290" r="8" fill="#2ecc71">
                        <animateTransform attributeName="transform" type="rotate" from="0 550 290" to="360 550 290" dur="3s" repeatCount="indefinite"/>
                    </circle>
                    
                    <!-- Applications list -->
                    <text x="400" y="380" text-anchor="middle" fill="#2c3e50" font-size="14">• 工程学中的振动分析</text>
                    <text x="400" y="405" text-anchor="middle" fill="#2c3e50" font-size="14">• 物理学中的波动理论</text>
                    <text x="400" y="430" text-anchor="middle" fill="#2c3e50" font-size="14">• 计算机图形学中的旋转变换</text>
                </g>
                
                <!-- Equation displays for each scene -->
                <text x="400" y="470" text-anchor="middle" class="equation-display" id="equationDisplay">
                    sin²θ + cos²θ = 1
                </text>
            </svg>
        </div>
        
        <div class="subtitle-container">
            <div class="subtitle" id="subtitle"></div>
        </div>
        
        <div class="controls">
            <button class="control-btn" id="playBtn" title="播放" disabled>
                <span id="playIcon">▶</span>
            </button>
            <button class="control-btn" id="muteBtn" title="静音">
                <span id="muteIcon">🔊</span>
            </button>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar">
                    <div class="progress-fill" id="progressFill"></div>
                    <div class="progress-handle" id="progressHandle"></div>
                </div>
                <div class="time-display" id="timeDisplay">00:00 / 00:00</div>
            </div>
        </div>
    </div>
    
    <div class="footer">
        © 2023 https://study11.ai/
    </div>
    
    <div id="audioContainer"></div>
    
    <script>
        const scenes = [
            {
                title: "三角函数简介",
                subtitle: "三角函数是数学中最重要的函数之一，描述了直角三角形中角度与边长的关系。主要包括正弦、余弦和正切函数。",
                equation: "sin²θ + cos²θ = 1",
                action: () => {
                    for (let i = 1; i <= 6; i++) {
                        document.getElementById(`scene${i}`).style.display = i === 1 ? 'block' : 'none';
                    }
                    document.getElementById('sceneTitle').textContent = "三角函数简介";
                    document.getElementById('sceneTitle').classList.add('active');
                    document.getElementById('equationDisplay').textContent = "sin²θ + cos²θ = 1";
                    document.getElementById('equationDisplay').classList.add('active');
                    document.getElementById('sceneNumber').textContent = '1';
                }
            },
            {
                title: "正弦函数",
                subtitle: "正弦函数描述角度对应的y坐标值。它是周期函数，周期为2π，值域在-1到1之间，在许多波动现象中都能见到。",
                equation: "y = sin x, x ∈ R, y ∈ [-1,1]",
                action: () => {
                    for (let i = 1; i <= 6; i++) {
                        document.getElementById(`scene${i}`).style.display = i === 2 ? 'block' : 'none';
                    }
                    document.getElementById('sceneTitle').textContent = "正弦函数";
                    document.getElementById('sceneTitle').classList.add('active');
                    document.getElementById('equationDisplay').textContent = "y = sin x, x ∈ R, y ∈ [-1,1]";
                    document.getElementById('equationDisplay').classList.add('active');
                    document.getElementById('sceneNumber').textContent = '2';
                }
            },
            {
                title: "余弦函数",
                subtitle: "余弦函数描述角度对应的x坐标值。与正弦函数相比，余弦函数向左平移了π/2个单位，同样具有周期性。",
                equation: "y = cos x, x ∈ R, y ∈ [-1,1]",
                action: () => {
                    for (let i = 1; i <= 6; i++) {
                        document.getElementById(`scene${i}`).style.display = i === 3 ? 'block' : 'none';
                    }
                    document.getElementById('sceneTitle').textContent = "余弦函数";
                    document.getElementById('sceneTitle').classList.add('active');
                    document.getElementById('equationDisplay').textContent = "y = cos x, x ∈ R, y ∈ [-1,1]";
                    document.getElementById('equationDisplay').classList.add('active');
                    document.getElementById('sceneNumber').textContent = '3';
                }
            },
            {
                title: "正切函数",
                subtitle: "正切函数等于正弦除以余弦，即tan x = sin x / cos x。它具有周期π，在x = π/2 + kπ处有垂直渐近线。",
                equation: "y = tan x = sin x / cos x",
                action: () => {
                    for (let i = 1; i <= 6; i++) {
                        document.getElementById(`scene${i}`).style.display = i === 4 ? 'block' : 'none';
                    }
                    document.getElementById('sceneTitle').textContent = "正切函数";
                    document.getElementById('sceneTitle').classList.add('active');
                    document.getElementById('equationDisplay').textContent = "y = tan x = sin x / cos x";
                    document.getElementById('equationDisplay').classList.add('active');
                    document.getElementById('sceneNumber').textContent = '4';
                }
            },
            {
                title: "函数性质",
                subtitle: "三角函数之间存在重要的恒等式关系。最基本的是勾股定理的推广：sin²x + cos²x = 1，这是所有三角恒等式的基础。",
                equation: "sin²x + cos²x = 1, tan x = sin x / cos x",
                action: () => {
                    for (let i = 1; i <= 6; i++) {
                        document.getElementById(`scene${i}`).style.display = i === 5 ? 'block' : 'none';
                    }
                    document.getElementById('sceneTitle').textContent = "函数性质";
                    document.getElementById('sceneTitle').classList.add('active');
                    document.getElementById('equationDisplay').textContent = "sin²x + cos²x = 1";
                    document.getElementById('equationDisplay').classList.add('active');
                    document.getElementById('sceneNumber').textContent = '5';
                }
            },
            {
                title: "实际应用",
                subtitle: "三角函数在现实世界中应用广泛：声波和光波的传播、钟摆和弹簧的振动、天体运动、建筑工程、信号处理等领域都离不开三角函数。",
                equation: "f(t) = A sin(ωt + φ)",
                action: () => {
                    for (let i = 1; i <= 6; i++) {
                        document.getElementById(`scene${i}`).style.display = i === 6 ? 'block' : 'none';
                    }
                    document.getElementById('sceneTitle').textContent = "实际应用";
                    document.getElementById('sceneTitle').classList.add('active');
                    document.getElementById('equationDisplay').textContent = "f(t) = A sin(ωt + φ)";
                    document.getElementById('equationDisplay').classList.add('active');
                    document.getElementById('sceneNumber').textContent = '6';
                }
            }
        ];
        
        let currentScene = 0;
        let isPlaying = false;
        let isMuted = false;
        let audioElements = [];
        let totalDuration = 0;
        let sceneTimestamps = [];
        let isDragging = false;
        let audioCache = {};
        let cacheExpiry = 7 * 24 * 60 * 60 * 1000;
        let pausedScene = 0;
        let pausedTime = 0;
        let wasPausedByUser = false;
        
        const playBtn = document.getElementById('playBtn');
        const playIcon = document.getElementById('playIcon');
        const muteBtn = document.getElementById('muteBtn');
        const muteIcon = document.getElementById('muteIcon');
        const progressBar = document.getElementById('progressBar');
        const progressFill = document.getElementById('progressFill');
        const progressHandle = document.getElementById('progressHandle');
        const subtitle = document.getElementById('subtitle');
        const loading = document.getElementById('loading');
        const audioContainer = document.getElementById('audioContainer');
        const cacheIndicator = document.getElementById('cacheIndicator');
        const timeDisplay = document.getElementById('timeDisplay');
        const sceneTitle = document.getElementById('sceneTitle');
        const sceneNumber = document.getElementById('sceneNumber');
        const equationDisplay = document.getElementById('equationDisplay');
        
        function initAudioCache() {
            try {
                const cachedData = localStorage.getItem('ttsAudioCache');
                if (cachedData) {
                    const parsedCache = JSON.parse(cachedData);
                    const now = Date.now();
                    for (const key in parsedCache) {
                        if (parsedCache[key].timestamp + cacheExpiry < now) {
                            delete parsedCache[key];
                        }
                    }
                    audioCache = parsedCache;
                    localStorage.setItem('ttsAudioCache', JSON.stringify(audioCache));
                }
            } catch (e) {
                console.error('初始化音频缓存失败:', e);
                audioCache = {};
            }
        }
        
        function blobToBase64(blob) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onloadend = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(blob);
            });
        }
        
        function base64ToBlob(base64) {
            const parts = base64.split(';base64,');
            const contentType = parts[0].split(':')[1];
            const raw = window.atob(parts[1]);
            
            const uInt8Array = new Uint8Array(raw.length);
            for (let i = 0; i < raw.length; ++i) {
                uInt8Array[i] = raw.charCodeAt(i);
            }
            
            return new Blob([uInt8Array], { type: contentType });
        }
        
        async function saveAudioToCache(text, blob) {
            try {
                const base64Data = await blobToBase64(blob);
                audioCache[text] = {
                    data: base64Data,
                    timestamp: Date.now()
                };
                localStorage.setItem('ttsAudioCache', JSON.stringify(audioCache));
            } catch (e) {
                console.error('保存音频缓存失败:', e);
            }
        }
        
        function getAudioFromCache(text) {
            if (audioCache[text] && audioCache[text].timestamp + cacheExpiry > Date.now()) {
                try {
                    const blob = base64ToBlob(audioCache[text].data);
                    return URL.createObjectURL(blob);
                } catch (e) {
                    console.error('从缓存恢复音频失败:', e);
                    return null;
                }
            }
            return null;
        }
        
        function initializeAudioElements() {
            audioContainer.innerHTML = '';
            audioElements = [];
            
            scenes.forEach((scene, index) => {
                const audio = document.createElement('audio');
                audio.id = `audio-${index}`;
                audio.preload = 'auto';
                audioContainer.appendChild(audio);
                audioElements.push(audio);
            });
        }
        
        async function synthesizeSceneSpeech(index) {
            const text = scenes[index].subtitle;
            const encodedText = encodeURIComponent(text);
            
            const cachedAudioUrl = getAudioFromCache(text);
            if (cachedAudioUrl) {
                cacheIndicator.classList.add('active');
                setTimeout(() => {
                    cacheIndicator.classList.remove('active');
                }, 2000);
                
                audioElements[index].src = cachedAudioUrl;
                
                return new Promise((resolve) => {
                    audioElements[index].onloadedmetadata = () => {
                        scenes[index].duration = audioElements[index].duration * 1000;
                        resolve();
                    };
                });
            }
            
            try {
                const response = await fetch(`https://javalinux.explanation.fun/tts?input=${encodedText}`);
                const blob = await response.blob();
                const audioUrl = URL.createObjectURL(blob);
                
                await saveAudioToCache(text, blob);
                
                audioElements[index].src = audioUrl;
                
                return new Promise((resolve) => {
                    audioElements[index].onloadedmetadata = () => {
                        scenes[index].duration = audioElements[index].duration * 1000;
                        resolve();
                    };
                });
            } catch (error) {
                console.error(`场景 ${index} TTS合成失败:`, error);
                scenes[index].duration = 6000;
                resolve();
            }
        }
        
        function formatTime(milliseconds) {
            const totalSeconds = Math.floor(milliseconds / 1000);
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        function updateTimeDisplay(currentTime, totalTime) {
            const currentTimeStr = formatTime(currentTime);
            const totalTimeStr = formatTime(totalTime);
            timeDisplay.textContent = `${currentTimeStr} / ${totalTimeStr}`;
        }
        
        async function preloadAllAudio() {
            loading.classList.add('active');
            playBtn.disabled = true;
            
            initAudioCache();
            initializeAudioElements();
            
            for (let i = 0; i < scenes.length; i++) {
                await synthesizeSceneSpeech(i);
            }
            
            calculateTimestamps();
            updateTimeDisplay(0, totalDuration);
            
            loading.classList.remove('active');
            playBtn.disabled = false;
        }
        
        function calculateTimestamps() {
            sceneTimestamps = [];
            let accumulatedTime = 0;
            
            scenes.forEach((scene) => {
                sceneTimestamps.push(accumulatedTime);
                accumulatedTime += scene.duration;
            });
            
            totalDuration = accumulatedTime;
        }
        
        function updateProgress() {
            if (!isPlaying) return;
            
            const currentAudio = audioElements[currentScene];
            if (!currentAudio) return;
            
            const sceneStartTime = sceneTimestamps[currentScene];
            const currentTime = sceneStartTime + (currentAudio.currentTime * 1000);
            const progress = Math.min((currentTime / totalDuration) * 100, 100);
            
            progressFill.style.width = progress + '%';
            progressHandle.style.left = progress + '%';
            
            updateTimeDisplay(currentTime, totalDuration);
            
            if (progress >= 100) {
                stopAnimation();
            } else {
                requestAnimationFrame(updateProgress);
            }
        }
        
        function playScene(sceneIndex) {
            if (sceneIndex >= scenes.length) {
                stopAnimation();
                return;
            }
            
            if (currentScene < audioElements.length && audioElements[currentScene]) {
                audioElements[currentScene].pause();
            }
            
            currentScene = sceneIndex;
            const scene = scenes[sceneIndex];
            const audio = audioElements[sceneIndex];
            
            subtitle.textContent = scene.subtitle;
            subtitle.classList.add('active');
            scene.action();
            
            if (audio && !isMuted) {
                audio.currentTime = 0;
                audio.play().catch(e => console.log('音频播放失败:', e));
                
                audio.onended = () => {
                    subtitle.classList.remove('active');
                    equationDisplay.classList.remove('active');
                    playScene(currentScene + 1);
                };
            } else {
                setTimeout(() => {
                    subtitle.classList.remove('active');
                    equationDisplay.classList.remove('active');
                    playScene(currentScene + 1);
                }, scene.duration);
            }
        }
        
        function startAnimation() {
            if (isPlaying) return;
            
            isPlaying = true;
            playIcon.textContent = '⏸';
            
            if (wasPausedByUser && pausedScene < scenes.length) {
                const scene = scenes[pausedScene];
                const audio = audioElements[pausedScene];
                
                subtitle.textContent = scene.subtitle;
                subtitle.classList.add('active');
                scene.action();
                
                currentScene = pausedScene;
                
                if (audio && !isMuted) {
                    audio.currentTime = pausedTime / 1000;
                    audio.play().catch(e => console.log('音频播放失败:', e));
                    
                    audio.onended = () => {
                        subtitle.classList.remove('active');
                        equationDisplay.classList.remove('active');
                        playScene(currentScene + 1);
                    };
                } else {
                    setTimeout(() => {
                        subtitle.classList.remove('active');
                        equationDisplay.classList.remove('active');
                        playScene(currentScene + 1);
                    }, scene.duration - pausedTime);
                }
                
                wasPausedByUser = false;
            } else {
                currentScene = 0;
                playScene(0);
            }
            
            updateProgress();
        }
        
        function pauseAnimation() {
            isPlaying = false;
            playIcon.textContent = '▶';
            wasPausedByUser = true;
            
            if (currentScene < audioElements.length && audioElements[currentScene]) {
                const audio = audioElements[currentScene];
                pausedScene = currentScene;
                pausedTime = audio.currentTime * 1000;
                audio.pause();
            }
        }
        
        function stopAnimation() {
            pauseAnimation();
            currentScene = 0;
            pausedScene = 0;
            pausedTime = 0;
            wasPausedByUser = false;
            progressFill.style.width = '0%';
            progressHandle.style.left = '0%';
            subtitle.textContent = '';
            
            updateTimeDisplay(0, totalDuration);
            
            for (let i = 1; i <= 6; i++) {
                document.getElementById(`scene${i}`).style.display = 'none';
            }
            
            sceneTitle.classList.remove('active');
            equationDisplay.classList.remove('active');
            sceneNumber.textContent = '1';
        }
        
        function toggleMute() {
            isMuted = !isMuted;
            muteIcon.textContent = isMuted ? '🔇' : '🔊';
            
            audioElements.forEach(audio => {
                audio.muted = isMuted;
            });
        }
        
        function handleProgressClick(e) {
            const rect = progressBar.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const percentage = Math.max(0, Math.min(100, (x / rect.width) * 100));
            
            progressFill.style.width = percentage + '%';
            progressHandle.style.left = percentage + '%';
            
            const targetTime = (percentage / 100) * totalDuration;
            updateTimeDisplay(targetTime, totalDuration);
            
            let targetScene = 0;
            for (let i = 0; i < sceneTimestamps.length; i++) {
                if (targetTime >= sceneTimestamps[i]) {
                    targetScene = i;
                } else {
                    break;
                }
            }
            
            pausedScene = targetScene;
            pausedTime = targetTime - sceneTimestamps[targetScene];
            
            if (isPlaying) {
                if (currentScene < audioElements.length && audioElements[currentScene]) {
                    audioElements[currentScene].pause();
                }
                
                const sceneOffset = targetTime - sceneTimestamps[targetScene];
                
                currentScene = targetScene;
                const scene = scenes[targetScene];
                const audio = audioElements[targetScene];
                
                subtitle.textContent = scene.subtitle;
                subtitle.classList.add('active');
                scene.action();
                
                if (audio && !isMuted) {
                    audio.currentTime = sceneOffset / 1000;
                    audio.play().catch(e => console.log('音频播放失败:', e));
                    
                    audio.onended = () => {
                        subtitle.classList.remove('active');
                        equationDisplay.classList.remove('active');
                        playScene(currentScene + 1);
                    };
                } else {
                    setTimeout(() => {
                        subtitle.classList.remove('active');
                        equationDisplay.classList.remove('active');
                        playScene(currentScene + 1);
                    }, scene.duration - sceneOffset);
                }
            } else if (wasPausedByUser) {
                currentScene = targetScene;
                const scene = scenes[targetScene];
                
                subtitle.textContent = scene.subtitle;
                subtitle.classList.add('active');
                scene.action();
            }
        }
        
        playBtn.addEventListener('click', () => {
            if (isPlaying) {
                pauseAnimation();
            } else {
                startAnimation();
            }
        });
        
        muteBtn.addEventListener('click', toggleMute);
        progressBar.addEventListener('click', handleProgressClick);
        
        progressHandle.addEventListener('mousedown', () => isDragging = true);
        document.addEventListener('mousemove', (e) => {
            if (isDragging) {
                handleProgressClick(e);
            }
        });
        document.addEventListener('mouseup', () => {
            if (isDragging) {
                isDragging = false;
            }
        });
        
        window.addEventListener('load', () => {
            preloadAllAudio();
        });
    </script>
</body>
</html>